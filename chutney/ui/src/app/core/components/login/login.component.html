<!--
  ~ SPDX-FileCopyrightText: 2017-2024 Enedis
  ~
  ~ SPDX-License-Identifier: Apache-2.0
  ~
  -->

<div class="wrapper">
  <header class="d-flex flex-md-row py-3 px-4 bg-primary">
    <div class="text-white me-4">
      <img src="../../../assets/img/logo.png" class="logo" alt="chutney logo"/>
      <strong class="title text-bottom">Chutney</strong>
    </div>
  </header>

  <div class="login-container">
    <div class="instance-info">
      <div class="text-center fs-3">
        {{ applicationName }}
      </div>
      <div class="instance-img" alt="homepage image">
      </div>
    </div>

    <div class="shadow p-4 w-75 rounded bg-light bg-opacity-75">

      @if (this.enableUserPassword && this.enableSso) {
        <ul ngbNav #nav="ngbNav" [(activeId)]="activeTab" class="nav nav-tabs flex-row">
          <li [ngbNavItem]="1" class="nav-item px-2 mx-2">
            <a ngbNavLink class="nav-link bg-secondary-subtle rounded fw-semibold" (click)="this.activeTab=1" aria-controls="userpassword">
               {{ 'login.userPassword' | translate }}
            </a>
            <ng-template ngbNavContent>
              <ng-container *ngTemplateOutlet="userPassword"></ng-container>
            </ng-template>
          </li>
          <li [ngbNavItem]="2" class="nav-item px-2 mx-2">
            <a ngbNavLink class="nav-link bg-secondary-subtle rounded fw-semibold" (click)="this.activeTab=2" aria-controls="sso">
               {{ 'login.sso.sso' | translate }}
            </a>
            <ng-template ngbNavContent>
              <ng-container *ngTemplateOutlet="sso"></ng-container>
            </ng-template>
          </li>
        </ul>
        <div [ngbNavOutlet]="nav" class="mt-2"></div>
      }

      @if (this.enableUserPassword && !this.enableSso) {
        <ng-container *ngTemplateOutlet="userPassword"></ng-container>
      }

      @if (!this.enableUserPassword && this.enableSso) {
        <ng-container *ngTemplateOutlet="sso"></ng-container>
      }

      @if (!this.enableUserPassword && !this.enableSso) {
        <p>{{ 'login.missingConf' | translate }}</p>
      }

      <ng-template #userPassword>
        <div id="userpassword">
          <form name="form" (ngSubmit)="login()">

          <div class="form-floating mb-2 mt-4">
            <input type="text" id="username" class="form-control"
              placeholder="{{ 'login.enter' | translate }} {{ 'login.username' | translate }}"
              [(ngModel)]="username" [ngModelOptions]="{standalone: true}"/>
            <label class="form-label" for="username">{{ 'login.username' | translate }}</label>
          </div>

          <div class="form-floating mb-2">
            <input type="password" id="password" class="form-control"
              placeholder="{{ 'login.enter' | translate }} {{ 'login.password' | translate }}"
              [(ngModel)]="password" [ngModelOptions]="{standalone: true}"/>
            <label class="form-label" for="password">{{ 'login.password' | translate }}</label>
          </div>

          <div class="d-flex justify-content-center text-lg-start">
            <button type="submit" class="btn btn-primary btn-lg w-50">Login</button>
          </div>
          </form>
        </div>
      </ng-template>

      <ng-template #sso>
        <div id="sso">
          <div class="text-center text-lg-start mt-2 pt-2 d-flex justify-content-center">
            <button class="btn btn-lg" [ngClass]="getSsoProviderName() ? 'btn-secondary' : ''" (click)="connectSso()">
                @if (getSsoProviderImageUrl()) {
                  <img src="{{getSsoProviderImageUrl()}}" class="ssoImage" alt="sso"/>
                }
                @if (getSsoProviderName()) {
                  <span class="ms-2">{{getSsoProviderName()}}</span>
                }
            </button>
          </div>
        </div>
      </ng-template>
        
      @if (loginService.connectionErrorMessage) {
        <div class="alert alert-danger mt-4">
            <div class="d-flex justify-content-between align-items-center m-0 p-0">
                {{ loginService.connectionErrorMessage }}
                @if (loginService.connectionErrorMessage === loginService.ssoUserNotFoundMessage) {
                    <button class="btn btn-lg" (click)="loginService.logout()">
                        Logout from SSO
                    </button>
                }
            </div>
        </div>
      }
    
    </div>
  </div>

  <footer
    class="d-flex flex-md-row text-center text-md-start justify-content-between py-4 px-4 px-xl-5 bg-primary">
    <div class="text-white me-4">
      <strong>Version</strong> - <small>{{ version }}</small>
    </div>

    <div>
      <a href="https://github.com/Enedis-OSS/chutney" rel="noopener noreferrer" target="_blank" class="text-white me-4">
        <i class="fab fa-github fa-2x"></i>
      </a>
    </div>
  </footer>
</div>
