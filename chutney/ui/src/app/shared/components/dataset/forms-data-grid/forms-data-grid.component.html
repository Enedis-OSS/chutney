<!--
  ~ SPDX-FileCopyrightText: 2017-2024 Enedis
  ~
  ~ SPDX-License-Identifier: Apache-2.0
  ~
  -->

<div class="m-3">
    <button type="button" class="btn btn-primary" (click)="addLine()">
        {{ 'global.actions.add' | translate }} <span class="fa fa-grip-lines" aria-hidden="true"></span>
    </button>
    <button type="button" class="btn btn-primary ms-2" (click)="addColumn()">
        {{ 'global.actions.add' | translate }} <span class="fa fa-grip-lines-vertical" aria-hidden="true"></span>
    </button>
    <span class="ms-3 text-danger " *ngIf="dataGridForm.hasError('duplicatedHeader')">{{"dataset.edition.multiple-values.validations.duplicatedHeader" | translate}}</span>

    @if (enableImportExport) {
        <div class="float-end">
            <button type="button" class="btn btn-primary" (click)="exportMultiKeyValue()">
                <span class="fa fa-file-csv" aria-hidden="true"></span> {{ 'global.actions.export' | translate }}
            </button>
            <div class="btn btn-primary div-file ms-2">
                <span class="fa fa-file-import" aria-hidden="true"></span> {{ 'global.actions.import' | translate }}
                <input class="input-file" type="file" name="file" multiple="false"
                       (change)="importMultiKeyValue($event.target.files)"/>
            </div>
        </div>
    }
</div>

<table class="table table-sm table-striped table-hover">
    <thead>
    <tr>
        <th style="width:30px"></th>
        <th class="header index-col">#</th>
        @for (header of headers; track header+i; let i = $index) {
            <th>
                <input
                    type="text"
                    class="form-control"
                    [value]="header"
                    (input)="updateHeader(i, $event.target.value)"
                    placeholder="{{ 'global.smallword.key' | translate }}"
                />
            </th>
        }
    </tr>
    </thead>

    <tbody>
        @for (line of dataGridForm.controls; track line; let i = $index) {
            <tr>
                <td>
                    <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeLine(i)">
                        <span class="fa fa-times"></span>
                    </button>
                </td>
                <td>{{ i + 1 }}</td>

                @for (keyValue of asFormArray(line).controls ; track keyValue; let j = $index) {
                    <td [formGroup]="asFormGroup(keyValue)">
                        <input
                            type="text"
                            class="form-control"
                            formControlName="value"
                            placeholder="{{ 'global.smallword.value' | translate }}"
                        />
                    </td>
                }
            </tr>
        }
    </tbody>
</table>
